"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[400],{92209:function(e,t,a){a.d(t,{Z:function(){return V}});var s=a(85893),i=a(67294),n=a(53648),r=a(80579),c=a(71232),l=a(95117),d=a(17789),o=a(56817),x=a(19236),m=a(62679),h=a(22870),u=a(95078),f=a(72445),j=a(49834),p=a(16173),g=a(98066),w=a(68103),y=a(22289);let Z=(0,o.k)(e=>({image:{border:"1px solid ".concat(e.colors.dark[0])},socialcard:{border:"1px solid ".concat(e.colors.dark[0]),borderRadius:e.radius.md}}));function b(e){let{address:t,access:a,data:i,setEditedGeneralData:n}=e,{classes:r}=Z();return i&&(0,s.jsxs)(s.Fragment,{children:[2==a&&(0,s.jsx)(y.Z,{initialValues:i,setEditedGeneralData:n}),(0,s.jsxs)(x.D,{order:3,children:[i.name,"'s profile"]}),(0,s.jsxs)(m.r,{mt:"xs",children:[(0,s.jsx)(m.r.Col,{span:3,children:(0,s.jsx)(h.E,{src:i.photo,height:200,width:200,radius:100,classNames:{image:"mantine-Image-image"},styles:{image:r.image},caption:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.x,{fw:500,children:i.name}),"".concat(t&&t.slice(0,6),"...").concat(t.slice(t.length-6,t.length))]})})}),(0,s.jsx)(m.r.Col,{span:5,children:(0,s.jsx)(u.i,{verticalSpacing:"sm",children:(0,s.jsxs)("tbody",{children:[(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:(0,s.jsx)(l.x,{tt:"capitalize",children:"Chain Address"})}),(0,s.jsx)("td",{children:(0,s.jsx)(l.x,{c:"dimmed",tt:"capitalize",span:!0,children:t})})]}),Object.keys(i).map((e,t)=>{if(-1==["photo","instagram","facebook","twitter"].indexOf(e))return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:(0,s.jsx)(l.x,{tt:"capitalize",children:e})}),(0,s.jsx)("td",{children:(0,s.jsx)(l.x,{c:"dimmed",tt:"capitalize",span:!0,children:i[e]})})]},t)})]})})}),(0,s.jsx)(m.r.Col,{span:1}),(0,s.jsx)(m.r.Col,{span:3,children:(0,s.jsxs)(f.W,{className:r.socialcard,p:"md",children:[(0,s.jsx)(l.x,{fw:"bold",children:"Social"}),(0,s.jsxs)(c.Z,{mt:"lg",children:[(0,s.jsx)(j.A,{component:"a",href:"https://instagram.com/".concat(i.instagram),target:"_blank",variant:"gradient",gradient:{from:"yellow",to:"purple",deg:45},children:(0,s.jsx)(p.Z,{})}),(0,s.jsx)(j.A,{component:"a",href:"https://facebook.com/".concat(i.facebook),target:"_blank",color:"indigo",children:(0,s.jsx)(g.Z,{})}),(0,s.jsx)(j.A,{component:"a",href:"https://twitter.com/".concat(i.twitter),target:"_blank",color:"blue",children:(0,s.jsx)(w.Z,{})})]})]})})]})]})}var D=a(88174),C=a(15472),v=a(67841),k=a(78978),S=a(27657),E=a(30688);function z(e){let{access:t,certificates:a,setEditedCertificates:i}=e;async function n(e,t){let{media:s}=t;s&&"File"==s.constructor.name&&(t.media=await (0,D.readAsDataURLAsync)(s));let n=[...a];e<a.length?n[e]={...t}:n.push(t),i(n)}return(0,s.jsxs)("div",{children:[a&&a.map((e,r)=>(0,s.jsxs)(C.Z,{shadow:"xs",padding:"lg",mb:"lg",radius:"md",children:[(0,s.jsx)(l.x,{weight:500,children:e.title}),(0,s.jsx)(l.x,{size:"sm",color:"dimmed",children:e.description}),(0,s.jsxs)(c.Z,{mt:"xs",children:[(0,s.jsx)(v.z,{component:"a",href:e.media,download:!0,compact:!0,children:"Download certificate"}),t>=1&&(0,s.jsx)(E.Z,{index:r,certificate:e,insertCertificate:n,BtnIcon:S.Z}),t>=1&&(0,s.jsx)(v.z,{onClick:()=>{i([...a.slice(0,r),...a.slice(r+1,a.length)])},variant:"subtle",color:"red",compact:!0,children:"Delete"})]})]},r)),t>=1&&(0,s.jsx)(E.Z,{index:a?a.length:1,certificate:{media:"",title:"",description:""},insertCertificate:n,BtnIcon:k.Z})]})}var A=a(95422),I=a(69077),L=a(25269),N=a(95439),F=a(23204),G=a(9066),O=a(48985),P=a(72466),R=a(11163),_=a(60503),B=a(63934),U=a(61263),H=a(94355),J=a.n(H),T=a(66981);function V(e){let{user:t,address:a,setData:o}=e,x=(0,R.useRouter)(),{address:m}=(0,I.mA)(),{status:h,generalData:u,certificatesData:{previousVersion:f,data:j,digitalSignatureOfLastUpdater:p},keyData:g,getData:w}=(0,n.Z)(a),{status:y,updateData:Z}=function(e,t){let{contractAddress:a,abi:s}=(0,N.Z)(),{isLoading:n,CIDs:r,setupCIDs:c,resetCIDs:l}=(0,L.Z)(e,t),[d,o]=(0,i.useState)(!1),[x,m]=(0,i.useState)(!1),{writeAsync:h,isLoading:u}=(0,I.GG)({address:a,abi:s,functionName:"setPtGeneralHash",args:[r.generalDataCID]}),{writeAsync:f,isLoading:j}=(0,I.GG)({address:a,abi:s,functionName:"setPtRecordHash",args:[e,r.keyDataCID]}),p=(0,F.Z)({uploading:n,txnLoading:u||j,txnWaiting:d,success:x});return(0,i.useEffect)(()=>{let{generalDataCID:e,keyDataCID:t}=r;(async()=>{try{let a=e&&await h(),s=t&&await f();o(!0),a&&await a.wait(1),s&&await s.wait(1),o(!1),(e||t)&&m(!0)}catch(e){console.log(e),l()}})()},[r]),{status:p,updateData:async function(e,t,a,s){try{await c(e,t,a,s)}catch(e){console.log(e)}}}}(a,m),{access:D}=(0,G.Z)(a),{recoverSigner:C}=(0,T.Z)(),[v,k]=(0,i.useState)("general-details"),[S,E]=(0,i.useState)(),[H,V]=(0,i.useState)(),[K,M]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{u&&j&&(E(u),j&&V(j.certificates),o&&o({generalData:u,certificatesData:{previousVersion:f,data:j,digitalSignatureOfLastUpdater:p},keyData:g}))},[u,j]),(0,i.useEffect)(()=>{u&&j&&M(!(J()(u,S)&&J()(j.certificates,H)))},[S,H]),(0,i.useEffect)(()=>{"success"==y&&x.reload(window.location.pathname)},[y]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(U.Z,{visible:Boolean(y),status:y}),(0,s.jsxs)(r.m,{value:v,onTabChange:k,orientation:"horizontal",px:"xl",mt:"md",children:[(0,s.jsxs)(r.m.List,{grow:!0,children:[(0,s.jsx)(r.m.Tab,{value:"general-details",children:"General Details"}),(0,s.jsx)(r.m.Tab,{value:"certificates",children:"Medical Certificates"})]}),(0,s.jsx)(r.m.Panel,{value:"general-details",mt:"md",h:"100%",children:(0,s.jsx)(B.Z,{status:h,SkeletonComponent:()=>(0,s.jsx)(O.Z,{status:h}),RetryComponent:()=>(0,s.jsx)(_.Z,{status:h,retryHandler:w}),DataComponent:()=>(0,s.jsx)(b,{address:a,access:D,data:S,setEditedGeneralData:E})})}),(0,s.jsx)(r.m.Panel,{value:"certificates",mt:"md",h:"100%",children:(0,s.jsx)(B.Z,{status:h,SkeletonComponent:()=>(0,s.jsx)(P.Z,{status:h}),RetryComponent:()=>(0,s.jsx)(_.Z,{status:h,retryHandler:w}),DataComponent:()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(c.Z,{mb:"xs",children:[(0,s.jsxs)(l.x,{c:"blue",size:"sm",fw:"bold",children:["Last Updated by:"," ",(0,s.jsx)(l.x,{c:"dimmed",span:!0,children:j.metadata.lastUpdatedBy})]}),(0,s.jsxs)(l.x,{c:"blue",size:"sm",fw:"bold",children:["Last Updated Date:"," ",(0,s.jsx)(l.x,{c:"dimmed",span:!0,children:j.metadata.lastUpdatedDate})]}),(0,s.jsxs)(l.x,{c:"blue",size:"sm",fw:"bold",children:["Version:"," ",(0,s.jsx)(l.x,{c:"dimmed",span:!0,children:j.metadata.version})]}),C(j,p)===j.metadata.lastUpdatedBy.toLowerCase()?(0,s.jsx)(d.C,{color:"green",children:"Valid signature"}):(0,s.jsx)(d.C,{color:"red",children:"Invalid signature"})]}),(0,s.jsx)(z,{access:D,certificates:H,setEditedCertificates:V})]})})})]}),(0,s.jsx)(A.Z,{isEdited:K,handleOnConfirm:async()=>{await Z({prevCertificatesData:{previousVersion:f,data:j,digitalSignatureOfLastUpdater:p},prevKeyData:g},J()(u,S)?null:S,J()(j.certificates,H)?null:H,g)},handleOnReset:()=>{E(u),V(j.certificates)}})]})}},53648:function(e,t,a){a.d(t,{Z:function(){return x}});var s=a(67294),i=a(69077),n=a(44480);a(88174);var r=a(99766),c=a(66066),l=a(40608),d=a(23204),o=a(48764).Buffer;function x(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{address:a}=(0,i.mA)(),{generalHash:x,keyHash:m,certificatesHash:h}=(0,l.Z)(e),[u,f]=(0,s.useState)({generalData:{},certificatesData:{},keyData:{}}),[j,p]=(0,s.useState)(!1),[g,w]=(0,s.useState)(!1),[y,Z]=(0,s.useState)(!1),b=(0,d.Z)({retrieving:j,success:g,failure:y});async function D(){let e=await (0,n.retrieveIPFS)(x),t=await (0,n.retrieveIPFS)(m),a=await (0,n.retrieveIPFS)(h);return{cipherGeneralData:e,cipherKey:t,cipherCertificatesData:a}}async function C(e){let{cipherGeneralData:t,cipherKey:s,cipherCertificatesData:i}=e,{key:n,iv:l}=JSON.parse(await (0,r.decryptData)(a,s.keys[a])),d=JSON.parse((0,c.symmetricDecrypt)(t,o.from(n,"hex"),o.from(l,"hex"))),x={...i,data:JSON.parse((0,c.symmetricDecrypt)(i.data,o.from(n,"hex"),o.from(l,"hex")))};d&&x&&f({generalData:d,certificatesData:x,keyData:s})}async function v(){p(!0);try{let e=await D();await C(e),w(!0)}catch(e){console.log(e),Z(!0)}p(!1)}return(0,s.useEffect)(()=>{t&&x&&m&&v()},[t,x,m]),{status:b,generalHash:x,keyHash:m,certificatesHash:h,...u,getData:v}}}}]);