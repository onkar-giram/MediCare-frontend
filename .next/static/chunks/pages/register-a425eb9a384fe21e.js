(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[495],{75511:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/register",function(){return a(48064)}])},20255:function(e,t,a){"use strict";a.d(t,{Z:function(){return o}});var i=a(67294),n=a(69077),s=a(95439),r=a(25269),c=a(88174),l=a(23204);function o(){let{address:e,contractAddress:t,abi:a,enabled:o}=(0,s.Z)(),{isLoading:u,CIDs:d,setupCIDs:m,resetCIDs:f}=(0,r.Z)(e),[h,b]=(0,i.useState)(!1),{data:p,refetch:x}=(0,n.do)({address:t,abi:a,functionName:"isPatient",args:[e],enabled:o}),{writeAsync:g,isLoading:j}=(0,n.GG)({address:t,abi:a,functionName:"registerPt",args:[d.generalDataCID,d.keyDataCID],enabled:o&&d.generalDataCID&&d.keyDataCID});(0,i.useEffect)(()=>{let{generalDataCID:e,keyDataCID:t}=d;e&&t&&(async()=>{try{let e=await g();b(!0),await e.wait(1),b(!1),await x()}catch(e){console.log(e)}f()})()},[d]);let v=(0,l.Z)({uploading:u,txnLoading:j,txnWaiting:h});return{isPatient:p,status:v,handleOnSumbit:async function(e){try{let{certificates:t}=e;delete e.certificates;let{dob:a}=e;a&&"Date"==a.constructor.name&&(e.dob=a.toDateString());let{photo:i}=e;for(let a in i&&"File"==i.constructor.name&&(e.photo=await (0,c.readAsDataURLAsync)(i)),t){let{media:e}=t[a];e&&"File"==e.constructor.name&&(t[a].media=await (0,c.readAsDataURLAsync)(e))}await m({prevCertificatesData:{},prevKeyData:{}},e,t)}catch(e){console.log(e)}}}}},48064:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return R}});var i=a(85893),n=a(67294),s=a(11163),r=a(69077),c=a(5911),l=a(66191),o=a(80579),u=a(65320),d=a(20255),m=a(71577),f=a(69469),h=a(67084),b=a(67841),p=a(71232),x=a(98903),g=a(368),j=a(75762),v=a(110),y=a(98401),w=a(31020),D=a(8861),Z=a(34119),S=a(35219),k=a(56837),C=a(39193);function A(e){let{user:t,initialValues:a,submitIsDisabled:s,handleOnSubmit:r}=e,[c,l]=(0,n.useState)(0),o=(0,x.c)({initialValues:{...a,certificates:a.certificates||[]},validate:{photo:e=>e?e.size/1024>250?"Size of file must be less than or equal to 250KB":null:"Photo cannot be empty",name:(0,g.d)({min:2,max:25},"Name must be 2-25 characters"),dob:(0,j.U)("Date of birth cannot be empty"),age:e=>e?e<18||e>99?"You must be 18-99 years old to register":null:"Age cannot be empty",gender:(0,v.w)(/^(male|female|Male|Female)$/,"Input must be Male/male or Female/female"),address:(0,j.U)("Address cannot be empty"),phone:(0,v.w)(/^\d{10}$/,"Phone number must be a 10 digit number"),email:(0,y.J)("Invalid Email")},validateInputOnChange:["photo"],validateInputOnBlur:["name","dob","age","gender","address","phone","email"]});return(0,i.jsxs)("form",{onSubmit:o.onSubmit(e=>r({...e})),children:[(0,i.jsxs)(m.v,{active:c,breakpoint:"sm",p:"sm",children:[(0,i.jsx)(m.v.Step,{label:"Profile",description:"Basic details",icon:(0,i.jsx)(D.Z,{}),children:(0,i.jsx)(f.M,{cols:2,children:(0,i.jsx)(k.Z,{form:o})})}),(0,i.jsxs)(m.v.Step,{label:"doctor"==t?"Doctor's Certificates":"Medical Certificates",description:"Let them know you better",icon:(0,i.jsx)(Z.Z,{}),children:[(0,i.jsx)(w.Z,{index:o.values.certificates.length,insertCertificate:function(e,t){e<o.values.certificates.length&&o.removeListItem("certificates",e),o.insertListItem("certificates",t,e)},values:o.values.certificates}),o.values.certificates.map((e,t)=>(0,i.jsx)(h.E,{block:!0,mt:"xl",children:JSON.stringify(e,null,2)},t))]}),(0,i.jsx)(m.v.Step,{label:"Social media",description:"Make it easy to contact you",icon:(0,i.jsx)(S.Z,{}),children:(0,i.jsx)(f.M,{cols:3,children:(0,i.jsx)(C.Z,{form:o})})}),(0,i.jsxs)(m.v.Completed,{children:[(0,i.jsx)(b.z,{type:"submit",disabled:s,children:"Submit"}),(0,i.jsx)(h.E,{block:!0,mt:"xl",children:JSON.stringify(o.values,null,2)})]})]}),(0,i.jsxs)(p.Z,{position:"right",mt:"xl",children:[0!==c&&(0,i.jsx)(b.z,{variant:"default",onClick:function(){l(e=>e>0?e-1:e)},children:"Back"}),3!==c&&(0,i.jsx)(b.z,{onClick:function(){l(e=>o.validate().hasErrors?e:e<3?e+1:e)},children:"Next step"})]})]})}a(98836);var E=a(61263);function I(){let{status:e,handleOnSumbit:t}=(0,d.Z)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(E.Z,{visible:e,status:e}),(0,i.jsx)(A,{user:"patient",initialValues:{},handleOnSubmit:t,submitIsDisabled:e})]})}var N=a(95439),L=a(47213),_=a(88174),F=a(23204);function O(){let{status:e,handleOnSubmit:t}=function(){let{address:e,contractAddress:t,abi:a,enabled:i}=(0,N.Z)(),{isLoading:s,dataCID:c,setupCID:l,resetCID:o}=(0,L.Z)(e),[u,d]=(0,n.useState)(!1),{data:m,refetch:f}=(0,r.do)({address:t,abi:a,functionName:"isDrRegistered",args:[e],enabled:i}),{writeAsync:h,isLoading:b}=(0,r.GG)({address:t,abi:a,functionName:"registerDr",args:[c],enabled:i&&c}),p=(0,F.Z)({uploading:s,txnLoading:b,txnWaiting:u});return(0,n.useEffect)(()=>{c&&(async()=>{try{let e=await h();d(!0),await e.wait(1),d(!1),await f()}catch(e){console.log(e)}o()})()},[c]),{isDoctorRegistered:m,status:p,handleOnSubmit:async function(e){try{let{dob:t}=e;t&&"Date"==t.constructor.name&&(e.dob=t.toDateString());let{photo:a}=e;for(let t in a&&"File"==a.constructor.name&&(e.photo=await (0,_.readAsDataURLAsync)(a)),e.certificates){let{media:a}=e.certificates[t];"File"==a.constructor.name&&(e.certificates[t].media=await (0,_.readAsDataURLAsync)(a))}await l(e)}catch(e){console.log(e)}}}}();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(E.Z,{visible:e,status:e}),(0,i.jsx)(A,{user:"doctor",initialValues:{},submitIsDisabled:e,handleOnSubmit:t})]})}var P=a(11417);function R(){let[e,t]=(0,n.useState)("patient"),{address:a}=(0,r.mA)(),{isDoctorRegistered:d,isFetched:m}=(0,c.Z)(a),{isPatient:f,isFetched:h}=(0,l.Z)(a),b=(0,s.useRouter)();return(0,n.useEffect)(()=>{a||b.replace("/")},[a]),(0,n.useEffect)(()=>{d&&b.replace("/doctor/dashboard"),f&&b.replace("/patient/dashboard")},[f,d]),(0,i.jsx)(u.Z,{loading:!m||!h||f||d,navlinks:[{label:"Registration",location:"",icon:P.Z}],Controller:()=>(0,i.jsxs)(o.m,{value:e,onTabChange:t,px:"xl",pt:"md",keepMounted:!1,children:[(0,i.jsxs)(o.m.List,{grow:!0,mb:"xl",children:[(0,i.jsx)(o.m.Tab,{value:"patient",children:"Register as patient"}),(0,i.jsx)(o.m.Tab,{value:"doctor",children:"Register as doctor"})]}),(0,i.jsx)(o.m.Panel,{value:"patient",children:(0,i.jsx)(I,{})}),(0,i.jsx)(o.m.Panel,{value:"doctor",children:(0,i.jsx)(O,{})})]})})}}},function(e){e.O(0,[297,714,324,737,213,78,779,164,791,250,774,888,179],function(){return e(e.s=75511)}),_N_E=e.O()}]);