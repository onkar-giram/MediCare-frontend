(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[222],{54991:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/patient/[location]",function(){return a(14200)}])},17591:function(e,t,a){"use strict";a.d(t,{Z:function(){return y}});var r=a(85893),s=a(67294),n=a(80579),o=a(67841),c=a(54777),l=a(19236),i=a(37101),d=a(56817),u=a(62679),h=a(95117),f=a(43523),x=a(17789),g=a(69469);let m=(0,d.k)(e=>({doctorBtn:{cursor:"pointer",padding:e.spacing.lg,backgroundColor:"light"==e.colorScheme?e.white:e.colors.dark[6],border:"1px solid ".concat("light"==e.colorScheme?e.colors.gray[1]:e.black),borderRadius:e.radius.md,boxShadow:e.shadows.xs,transition:"200ms","&:hover":{transform:"scale(1.005)",backgroundColor:"light"==e.colorScheme?e.colors.gray[0]:e.colors.dark[5],boxShadow:e.shadows.sm,border:"1px solid ".concat("light"==e.colorScheme?e.colors.gray[2]:e.colors.gray[9])},"&:active":{transform:"scale(0.99)"}}}));function D(e){let{index:t,doctor:a,pending:s,onClick:n}=e,{classes:o}=m();return(0,r.jsxs)(u.r,{className:o.doctorBtn,onClick:n,mt:"xs",children:[(0,r.jsx)(u.r.Col,{span:1,children:(0,r.jsx)(h.x,{fz:"sm",fw:500,children:t+1})}),(0,r.jsx)(u.r.Col,{span:"auto",children:(0,r.jsx)(f.M,{children:(0,r.jsx)(h.x,{fz:"sm",fw:500,children:a})})}),(0,r.jsx)(u.r.Col,{span:2,dir:"rtl",children:(0,r.jsx)(x.C,{color:s?"green":"red",children:s?"Approved":"Not approved"})})]})}function j(e){let{allDoctors:t,pendingDoctors:a,setActiveTab:s}=e;return(0,r.jsxs)(g.M,{px:"xl",children:[(0,r.jsx)(h.x,{fz:"xl",fw:500,children:"All doctors"}),(0,r.jsx)(c.i,{}),t&&t.map((e,t)=>a&&(0,r.jsx)("div",{children:(0,r.jsx)(D,{index:t,doctor:e,pending:-1==a.indexOf(e),onClick:()=>s(e)})},t))]})}var p=a(69077),v=a(95439),w=a(33507);function y(e){let{user:t,setDoctor:a}=e,{allDoctors:d}=function(){let{contractAddress:e,abi:t,enabled:a}=(0,v.Z)(),{data:r}=(0,p.do)({address:e,abi:t,functionName:"getAllDrs",enabled:a});return{allDoctors:r}}(),{pendingDoctors:u}=function(){let{contractAddress:e,abi:t,enabled:a}=(0,v.Z)(),{data:r}=(0,p.do)({address:e,abi:t,functionName:"getPendingDrs",enabled:a});return{pendingDoctors:r}}(),[h,f]=(0,s.useState)("all");return(0,s.useEffect)(()=>{"all"==h&&a&&a(null)},[h]),d&&d.length>0?(0,r.jsxs)(n.m,{orientation:"vertical",onTabChange:f,value:h,keepMounted:!1,children:[(0,r.jsx)(n.m.Panel,{value:"all",children:(0,r.jsx)(n.m.List,{children:(0,r.jsx)(j,{allDoctors:d,pendingDoctors:u,setActiveTab:f})})}),d&&d.map((e,s)=>(0,r.jsxs)(n.m.Panel,{value:e,children:[(0,r.jsx)(o.z,{variant:"light",onClick:()=>f("all"),w:"100%",leftIcon:(0,r.jsx)(w.Z,{}),children:"Back to all doctors"}),(0,r.jsx)(c.i,{my:"sm"}),(0,r.jsx)(i.Z,{address:e,user:t,setDoctor:a})]},s))]}):(0,r.jsx)(l.D,{order:4,children:"No doctor registered yet"})}},29010:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var r=a(67294),s=a(69077),n=a(95439),o=a(25269);a(53648);var c=a(23204);function l(e){let{address:t,contractAddress:a,abi:l,enabled:i}=(0,n.Z)(),[d,u]=(0,r.useState)(!1),[h,f]=(0,r.useState)(!1),{isLoading:x,CIDs:g,setupCIDs:m,resetCIDs:D}=(0,o.Z)(t,e),{writeAsync:j,isLoading:p}=(0,s.GG)({address:a,abi:l,functionName:"changeEditorAccess",args:[e,g.generalDataCID,g.keyDataCID],enabled:i&&e&&g.generalDataCID&&g.keyDataCID}),v=(0,c.Z)({uploading:x,txnLoading:p,txnWaiting:d,success:h});return(0,r.useEffect)(()=>{g.generalDataCID&&g.keyDataCID&&(async()=>{try{let e=await j();u(!0),await e.wait(1),u(!1),f(!0)}catch(e){console.log(e)}D()})()},[g]),{status:v,runChangeEditorAccess:async function(e){let{generalData:t,certificatesData:a,keyData:r}=e;try{await m({prevCertificatesData:a,prevKeyData:r},t,a.data.certificates)}catch(e){console.log(e)}}}}},3332:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var r=a(64146),s=a(67294),n=a(69077),o=a(95439),c=a(23204);function l(){let{contractAddress:e,abi:t,enabled:a}=(0,o.Z)(),{data:l}=(0,n.mx)(),[i,d]=(0,s.useState)(""),[u,h]=(0,s.useState)(!1),[f,x]=(0,s.useState)(),g=(0,c.Z)({txnLoading:u,success:f});async function m(){let a=new r.CH(e,t,l);return await a.getDrOfPt()}return(0,s.useEffect)(()=>{(async()=>{try{if(a&&l){h(!0);let e=await m();d(e),h(!1),x(!0)}}catch(e){console.log(e)}})()},[a,l]),{status:g,doctor:i,getDoctorOfPatient:m}}},14200:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Z}});var r=a(85893),s=a(67294),n=a(69077),o=a(11163),c=a(3332),l=a(29010),i=a(95439),d=a(25269),u=a(23204),h=a(17591),f=a(37101),x=a(92209),g=a(80579),m=a(67841),D=a(19236),j=a(61263);function p(){let{address:e}=(0,n.mA)(),{status:t,doctor:a}=(0,c.Z)(),p=(0,o.useRouter)(),{location:v}=p.query,[w,y]=(0,s.useState)(null),[C,k]=(0,s.useState)(null),{status:Z,runChangeEditorAccess:b}=(0,l.Z)(C),{status:S,runRemoveEditorAccess:E}=function(){let{address:e,contractAddress:t,abi:a,enabled:r}=(0,i.Z)(),[o,c]=(0,s.useState)(!1),[l,h]=(0,s.useState)(!1),{isLoading:f,CIDs:x,setupCIDs:g,resetCIDs:m}=(0,d.Z)(e),{writeAsync:D,isLoading:j}=(0,n.GG)({address:t,abi:a,functionName:"removeEditorAccess",args:[x.generalDataCID,x.keyDataCID],enabled:r&&x.generalDataCID&&x.keyDataCID}),p=(0,u.Z)({uploading:f,txnLoading:j,txnWaiting:o,success:l});return(0,s.useEffect)(()=>{x.generalDataCID&&x.keyDataCID&&(async()=>{try{let e=await D();c(!0),await e.wait(1),c(!1),h(!0)}catch(e){console.log(e)}m()})()},[x]),{status:p,runRemoveEditorAccess:async function(e){let{generalData:t,certificatesData:a,keyData:r}=e;try{await g({prevCertificatesData:a,prevKeyData:r},t,a.data.certificates)}catch(e){console.log(e)}}}}();return(0,s.useEffect)(()=>{("success"==Z||"success"==S)&&p.reload(window.location.pathname)},[Z,S]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.Z,{visible:Z||S,status:Z||S}),(0,r.jsxs)(g.m,{value:v,children:[(0,r.jsx)(g.m.Panel,{value:"dashboard",children:(0,r.jsx)(x.Z,{user:"patient",address:e,setData:y})}),(0,r.jsx)(g.m.Panel,{value:"my-doctor",children:e!=a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.Z,{user:"patient",address:a}),(0,r.jsx)(m.z,{onClick:()=>E(w),ml:"lg",variant:"white",disabled:S,compact:!0,children:"Revoke Access"})]}):(0,r.jsx)(D.D,{order:4,children:"No doctor is allowed to view / edit your data"})}),(0,r.jsxs)(g.m.Panel,{value:"all-doctors",children:[(0,r.jsx)(h.Z,{user:"patient",setDoctor:k}),C&&(0,r.jsx)(m.z,{onClick:()=>{C&&C!=a?b(w):E(w)},ml:"lg",variant:"white",disabled:Z||S,compact:!0,children:C!=a?"Grant your data access to this doctor":"Revoke access"})]})]})]})}var v=a(65320),w=a(66191),y=a(43818),C=a(72272),k=a(15710);function Z(){let{address:e}=(0,n.mA)(),{isPatient:t,isFetched:a}=(0,w.Z)(e),c=(0,o.useRouter)(),l=[{label:"Dashboard",location:"dashboard",icon:y.Z},{label:"My doctor",location:"my-doctor",icon:C.Z},{label:"All doctors",location:"all-doctors",icon:k.Z}];return(0,s.useEffect)(()=>{e||c.replace("/"),a&&!t&&c.replace("/register")},[e,t]),(0,r.jsx)(v.Z,{loading:!e||!a||!t,navlinks:l,Controller:p})}}},function(e){e.O(0,[297,714,849,324,737,213,78,779,164,581,498,791,250,101,400,774,888,179],function(){return e(e.s=54991)}),_N_E=e.O()}]);