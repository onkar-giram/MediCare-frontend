(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[791],{81999:function(t,e,n){"use strict";n.d(e,{Z:function(){return o}});var r=n(85893),a=n(67294),i=n(69077),l=n(64523),s=n(95117);function o(){let{connect:t,connectors:e}=(0,i.$4)(),{disconnect:n}=(0,i.qL)(),{isConnected:o,isDisconnected:c,address:u}=(0,i.mA)(),[f,h]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{window&&window.localStorage.getItem("connected")&&t({connector:e.at(0)})},[]),(0,a.useEffect)(()=>{h(o),o&&window&&window.localStorage.setItem("connected","metamask"),c&&window&&window.localStorage.removeItem("connected")},[o,c]),f?(0,r.jsxs)(l.x,{onClick:n,w:"100%",h:"100%",sx:{cursor:"pointer"},children:[u&&"".concat(u.substring(0,6),"...").concat(u.substring(u.length-6,u.length)),(0,r.jsx)(s.x,{c:"dimmed",size:"xs",children:"Disconnect"})]}):(0,r.jsx)(l.x,{onClick:async()=>{t({connector:e.at(0)})},w:"100%",h:"100%",sx:{cursor:"pointer"},children:"Connect"})}n(51521),n(2147)},2147:function(t,e,n){"use strict";var r=n(85893);function a(t){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.07em",height:"1em",viewBox:"0 0 256 240",...t,children:[(0,r.jsx)("path",{fill:"#E17726",d:"M250.066 0L140.219 81.279l20.427-47.9z"}),(0,r.jsx)("path",{fill:"#E27625",d:"m6.191.096l89.181 33.289l19.396 48.528zM205.86 172.858l48.551.924l-16.968 57.642l-59.243-16.311zm-155.721 0l27.557 42.255l-59.143 16.312l-16.865-57.643z"}),(0,r.jsx)("path",{fill:"#E27625",d:"m112.131 69.552l1.984 64.083l-59.371-2.701l16.888-25.478l.214-.245zm31.123-.715l40.9 36.376l.212.244l16.888 25.478l-59.358 2.7zM79.435 173.044l32.418 25.259l-37.658 18.181zm97.136-.004l5.131 43.445l-37.553-18.184z"}),(0,r.jsx)("path",{fill:"#D5BFB2",d:"m144.978 195.922l38.107 18.452l-35.447 16.846l.368-11.134zm-33.967.008l-2.909 23.974l.239 11.303l-35.53-16.833z"}),(0,r.jsx)("path",{fill:"#233447",d:"m100.007 141.999l9.958 20.928l-33.903-9.932zm55.985.002l24.058 10.994l-34.014 9.929z"}),(0,r.jsx)("path",{fill:"#CC6228",d:"m82.026 172.83l-5.48 45.04l-29.373-44.055zm91.95.001l34.854.984l-29.483 44.057zm28.136-44.444l-25.365 25.851l-19.557-8.937l-9.363 19.684l-6.138-33.849zm-148.237 0l60.435 2.749l-6.139 33.849l-9.365-19.681l-19.453 8.935z"}),(0,r.jsx)("path",{fill:"#E27525",d:"m52.166 123.082l28.698 29.121l.994 28.749zm151.697-.052l-29.746 57.973l1.12-28.8zm-90.956 1.826l1.155 7.27l2.854 18.111l-1.835 55.625l-8.675-44.685l-.003-.462zm30.171-.101l6.521 35.96l-.003.462l-8.697 44.797l-.344-11.205l-1.357-44.862z"}),(0,r.jsx)("path",{fill:"#F5841F",d:"m177.788 151.046l-.971 24.978l-30.274 23.587l-6.12-4.324l6.86-35.335zm-99.471 0l30.399 8.906l6.86 35.335l-6.12 4.324l-30.275-23.589z"}),(0,r.jsx)("path",{fill:"#C0AC9D",d:"m67.018 208.858l38.732 18.352l-.164-7.837l3.241-2.845h38.334l3.358 2.835l-.248 7.831l38.487-18.29l-18.728 15.476l-22.645 15.553h-38.869l-22.63-15.617z"}),(0,r.jsx)("path",{fill:"#161616",d:"m142.204 193.479l5.476 3.869l3.209 25.604l-4.644-3.921h-36.476l-4.556 4l3.104-25.681l5.478-3.871z"}),(0,r.jsx)("path",{fill:"#763E1A",d:"M242.814 2.25L256 41.807l-8.235 39.997l5.864 4.523l-7.935 6.054l5.964 4.606l-7.897 7.191l4.848 3.511l-12.866 15.026l-52.77-15.365l-.457-.245l-38.027-32.078zm-229.628 0l98.326 72.777l-38.028 32.078l-.457.245l-52.77 15.365l-12.866-15.026l4.844-3.508l-7.892-7.194l5.952-4.601l-8.054-6.071l6.085-4.526L0 41.809z"}),(0,r.jsx)("path",{fill:"#F5841F",d:"m180.392 103.99l55.913 16.279l18.165 55.986h-47.924l-33.02.416l24.014-46.808zm-104.784 0l-17.151 25.873l24.017 46.808l-33.005-.416H1.631l18.063-55.985zm87.776-70.878l-15.639 42.239l-3.319 57.06l-1.27 17.885l-.101 45.688h-30.111l-.098-45.602l-1.274-17.986l-3.32-57.045l-15.637-42.239z"})]})}n(67294),e.Z=a},47213:function(t,e,n){"use strict";n.d(e,{Z:function(){return i}});var r=n(67294),a=n(44480);function i(t){let[e,n]=(0,r.useState)(!1),[i,l]=(0,r.useState)(null);return{isLoading:e,dataCID:i,setupCID:async function(e){n(!0);try{console.log("Uploading data....");let n=await (0,a.makeFileObjects)([e],[t]),r=await (0,a.storeIPFS)(n,{wrapWithDirectory:!1});console.log(r),l(r)}catch(t){throw n(!1),t}n(!1)},resetCID:function(){l(null)}}}},25269:function(t,e,n){"use strict";n.d(e,{Z:function(){return d}});var r=n(67294),a=n(69077),i=n(95439);function l(t){let{contractAddress:e,abi:n,enabled:r}=(0,i.Z)(),{data:l,isFetched:s}=(0,a.do)({address:e,abi:n,functionName:"getDrPubKey",args:[t],enabled:r&&t});return{isFetched:s,publicKey:l}}var s=n(40608),o=n(66981),c=n(66066),u=n(99766),f=n(44480),h=n(48764).Buffer;function d(t,e){let{signCertificates:n}=(0,o.Z)(),{publicKey:a}=l(e||null),{certificatesHash:i}=(0,s.Z)(t),[d,p]=(0,r.useState)(!1),[g,y]=(0,r.useState)({generalDataCID:null,keyDataCID:null});return{isLoading:d,CIDs:g,setupCIDs:async function(r,l,s,o){let{prevCertificatesData:d,prevKeyData:g}=r;p(!0);try{let r,p,m;let w=e&&o&&o.keys[e]?e:t,{key:v,iv:x}=o?JSON.parse(await (0,u.decryptData)(w,o.keys[w])):(0,c.generateKey)();if(o&&(v=h.from(v,"hex"),x=h.from(x,"hex")),l){console.log("changing general data");let t=(0,c.symmetricEncrypt)(JSON.stringify(l),v,x),n=await (0,f.makeFileObjects)([t],[e]);r=await (0,f.storeIPFS)(n,{wrapWithDirectory:!1})}else r=null;if(s){console.log("changing certificates");let r={certificates:s,metadata:{version:d&&d.metadata?d.metadata.version+1:1,lastUpdatedDate:new Date(Date.now()).toDateString(),lastUpdatedBy:w}},a=(0,c.symmetricEncrypt)(JSON.stringify(r),v,x),l={previousVersion:{hash:i,key:g&&g.keys&&g.keys[t]},data:a,digitalSignatureOfLastUpdater:await n(r)},o=await (0,f.makeFileObjects)([l],[e]);p=await (0,f.storeIPFS)(o,{wrapWithDirectory:!1})}else p=null;if(s||!o||e&&w!=e){console.log("changing keys");let n=JSON.stringify({key:v.toString("hex"),iv:x.toString("hex")}),r={keys:e?{[t]:o?o.keys[t]:JSON.stringify(await (0,u.encryptData)(t,n)),[e]:o?o.keys[e]:JSON.stringify(await (0,u.encryptData)(null,n,a))}:{[t]:o?o.keys[t]:JSON.stringify(await (0,u.encryptData)(t,n))},medicalRecordCID:p||i},l=await (0,f.makeFileObjects)([r],[e]);m=await (0,f.storeIPFS)(l,{wrapWithDirectory:!1})}else m=null;y({generalDataCID:r,keyDataCID:m}),console.log(r),console.log(p),console.log(m)}catch(t){throw p(!1),t}p(!1)},resetCIDs:function(){y({generalDataCID:null,keyDataCID:null})}}}},40608:function(t,e,n){"use strict";n.d(e,{Z:function(){return c}});var r=n(67294),a=n(64146),i=n(69077),l=n(95439);function s(){let{contractAddress:t,abi:e,enabled:n}=(0,l.Z)(),{data:s}=(0,i.mx)(),[o,c]=(0,r.useState)(null);return(0,r.useEffect)(()=>{try{n&&s&&c(new a.CH(t,e,s))}catch(t){}},[n,s]),{contract:o}}var o=n(44480);function c(t){let{contract:e}=s(),[n,a]=(0,r.useState)({generalHash:null,keyHash:null,certificatesHash:null});async function i(){try{let n=await e.getPtGeneralHash(t),r=await e.getPtRecordHash(t),i=await (0,o.retrieveIPFS)(r),l=i.medicalRecordCID;a({generalHash:n,keyHash:r,certificatesHash:l})}catch(t){console.log(t)}}return(0,r.useEffect)(()=>{e&&t&&i()},[e,t]),n}n(88174)},66981:function(t,e,n){"use strict";n.d(e,{Z:function(){return i}});var r=n(69077),a=n(51091);function i(){let{chain:t}=(0,r.LN)(),e={name:"MedicalRecord signature"},n={EIP712Domain:[{name:"name",type:"string"}],Certificate:[{name:"title",type:"string"},{name:"description",type:"string"},{name:"media",type:"string"}],MetaData:[{name:"lastUpdatedDate",type:"string"},{name:"lastUpdatedBy",type:"address"},{name:"version",type:"int256"}],Data:[{name:"certificates",type:"Certificate[]"},{name:"metadata",type:"MetaData"}]},{signTypedDataAsync:i}=(0,r.yw)({domain:e,types:n}),l=(t,r)=>(0,a.recoverTypedSignature)({data:{domain:e,message:t,primaryType:"Data",types:n},signature:r,version:a.SignTypedDataVersion.V4});return{signCertificates:async t=>await i({value:t}),recoverSigner:l}}},23204:function(t,e,n){"use strict";n.d(e,{Z:function(){return a}});var r=n(67294);function a(t){let[e,n]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let{loading:e,uploading:r,retrieving:a,encrypting:i,decrypting:l,signing:s,txnLoading:o,txnWaiting:c,success:u,failure:f}=t;e?n("loading"):r?n("uploading"):a?n("retrieving"):i?n("encrypting"):l?n("decrypting"):s?n("signing"):o?n("txnLoading"):c?n("txnWaiting"):u?n("success"):f?n("failure"):n(null)},[t]),e}},95439:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(69077),a=n(59734);let i=t=>fetch(t).then(t=>t.json());function l(){let{data:t}=(0,a.ZP)("/api/constants",i),{chain:e}=(0,r.LN)(),{address:n}=(0,r.mA)(),l=t&&e&&JSON.parse(t).contractAddresses[e.id],s=t&&JSON.parse(t).abi,o=Boolean(t&&e&&n);return{address:n,chain:e,contractAddress:l,abi:s,enabled:o}}},66066:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});let r=n(42474);function a(){let t=(0,r.randomBytes)(32),e=(0,r.randomBytes)(16);return{key:t,iv:e}}function i(t,e,n){let a=(0,r.createCipheriv)("aes-256-gcm",e,n),i=a.update(t,"utf-8","hex");return i}function l(t,e,n){let a=(0,r.createDecipheriv)("aes-256-gcm",e,n),i=a.update(t,"hex","utf-8");return i}t.exports={generateKey:a,symmetricEncrypt:i,symmetricDecrypt:l}},44480:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});let r=n(92648).Z,a=n(80498),i=r(n(9669));async function l(){let t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJkaWQ6ZXRocjoweGE4QjU5NDUzMzNjRDdkMmI0MERDMTczMzlmNDkxODQxODE0YmY0NkUiLCJpc3MiOiJ3ZWIzLXN0b3JhZ2UiLCJpYXQiOjE2ODQ1ODM4NjU4NTIsIm5hbWUiOiJtZWRpY2FyZSJ9.WGeDiWh2Oh0eBjC53k8qDVdWfEPgY3ZvZhsuUI2J8ok";return new a.Web3Storage({token:t})}async function s(t,e){let n=[];for(let r=0;r<t.length;r++){let a=t[r],i=e[r],l="string"==typeof a?new Blob([a],{type:"application/json"}):new Blob([JSON.stringify(a)],{type:"application/json"});n.push(new File([l],i))}return n}async function o(t,e){let n=await l(),r=await n.put(t,e);return r}async function c(t){let e=await i.default.get("https://w3s.link/ipfs/".concat(t));return e.data}t.exports={makeFileObjects:s,storeIPFS:o,retrieveIPFS:c}},99766:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});let r=n(51091);async function a(t){return await window.ethereum.request({method:"eth_getEncryptionPublicKey",params:[t]})}async function i(t,e,n){let i=(0,r.encrypt)({publicKey:n||await a(t),data:e,version:"x25519-xsalsa20-poly1305"});return i}async function l(t,e){let n=await window.ethereum.request({method:"eth_decrypt",params:[e,t]});return n}async function s(t,e){console.log(t),console.log(e),window.ethereum.request({method:"eth_signTypedData_v4",params:[t,JSON.stringify(e)]}).then(t=>{console.log(t)}).catch(t=>{console.log(t)})}t.exports={getPublicKey:a,encryptData:i,decryptData:l,sign:s}},88174:function(t){"use strict";function e(t){return new Promise(e=>{let n=new FileReader;n.readAsDataURL(t),n.onloadend=()=>e(n.result)})}function n(t){return new Promise(e=>{let n=new FileReader;n.readAsText(t),n.onloadend=()=>e(n.result)})}t.exports={readAsDataURLAsync:e,readAsTextAsync:n}},51951:function(module){var __dirname="/";!function(){var __webpack_modules__={950:function(__unused_webpack_module,exports){var indexOf=function(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0;n<t.length;n++)if(t[n]===e)return n;return -1},Object_keys=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var n in t)e.push(n);return e},forEach=function(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n++)e(t[n],n,t)},defineProp=function(){try{return Object.defineProperty({},"_",{}),function(t,e,n){Object.defineProperty(t,e,{writable:!0,enumerable:!1,configurable:!0,value:n})}}catch(t){return function(t,e,n){t[e]=n}}}(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function(t){if(!(this instanceof Script))return new Script(t);this.code=t};Script.prototype.runInContext=function(t){if(!(t instanceof Context))throw TypeError("needs a 'context' argument.");var e=document.createElement("iframe");e.style||(e.style={}),e.style.display="none",document.body.appendChild(e);var n=e.contentWindow,r=n.eval,a=n.execScript;!r&&a&&(a.call(n,"null"),r=n.eval),forEach(Object_keys(t),function(e){n[e]=t[e]}),forEach(globals,function(e){t[e]&&(n[e]=t[e])});var i=Object_keys(n),l=r.call(n,this.code);return forEach(Object_keys(n),function(e){(e in t||-1===indexOf(i,e))&&(t[e]=n[e])}),forEach(globals,function(e){e in t||defineProp(t,e,n[e])}),document.body.removeChild(e),l},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function(t){var e=Script.createContext(t),n=this.runInContext(e);return t&&forEach(Object_keys(e),function(n){t[n]=e[n]}),n},forEach(Object_keys(Script.prototype),function(t){exports[t]=Script[t]=function(e){var n=Script(e);return n[t].apply(n,[].slice.call(arguments,1))}}),exports.isContext=function(t){return t instanceof Context},exports.createScript=function(t){return exports.Script(t)},exports.createContext=Script.createContext=function(t){var e=new Context;return"object"==typeof t&&forEach(Object_keys(t),function(n){e[n]=t[n]}),e}}};"undefined"!=typeof __nccwpck_require__&&(__nccwpck_require__.ab=__dirname+"/");var __webpack_exports__={};__webpack_modules__[950](0,__webpack_exports__),module.exports=__webpack_exports__}()},89509:function(t,e,n){/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var r=n(48764),a=r.Buffer;function i(t,e){for(var n in t)e[n]=t[n]}function l(t,e,n){return a(t,e,n)}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?t.exports=r:(i(r,e),e.Buffer=l),l.prototype=Object.create(a.prototype),i(a,l),l.from=function(t,e,n){if("number"==typeof t)throw TypeError("Argument must not be a number");return a(t,e,n)},l.alloc=function(t,e,n){if("number"!=typeof t)throw TypeError("Argument must be a number");var r=a(t);return void 0!==e?"string"==typeof n?r.fill(e,n):r.fill(e):r.fill(0),r},l.allocUnsafe=function(t){if("number"!=typeof t)throw TypeError("Argument must be a number");return a(t)},l.allocUnsafeSlow=function(t){if("number"!=typeof t)throw TypeError("Argument must be a number");return r.SlowBuffer(t)}},32553:function(t,e,n){"use strict";var r=n(89509).Buffer,a=r.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function i(t){var e;if(!t)return"utf8";for(;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}function l(t){var e=i(t);if("string"!=typeof e&&(r.isEncoding===a||!a(t)))throw Error("Unknown encoding: "+t);return e||t}function s(t){var e;switch(this.encoding=l(t),this.encoding){case"utf16le":this.text=p,this.end=g,e=4;break;case"utf8":this.fillLast=f,e=4;break;case"base64":this.text=y,this.end=m,e=3;break;default:this.write=w,this.end=v;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(e)}function o(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function c(t,e,n){var r=e.length-1;if(r<n)return 0;var a=o(e[r]);return a>=0?(a>0&&(t.lastNeed=a-1),a):--r<n||-2===a?0:(a=o(e[r]))>=0?(a>0&&(t.lastNeed=a-2),a):--r<n||-2===a?0:(a=o(e[r]))>=0?(a>0&&(2===a?a=0:t.lastNeed=a-3),a):0}function u(t,e,n){if((192&e[0])!=128)return t.lastNeed=0,"�";if(t.lastNeed>1&&e.length>1){if((192&e[1])!=128)return t.lastNeed=1,"�";if(t.lastNeed>2&&e.length>2&&(192&e[2])!=128)return t.lastNeed=2,"�"}}function f(t){var e=this.lastTotal-this.lastNeed,n=u(this,t,e);return void 0!==n?n:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):void(t.copy(this.lastChar,e,0,t.length),this.lastNeed-=t.length)}function h(t,e){var n=c(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=n;var r=t.length-(n-this.lastNeed);return t.copy(this.lastChar,0,r),t.toString("utf8",e,r)}function d(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"�":e}function p(t,e){if((t.length-e)%2==0){var n=t.toString("utf16le",e);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function g(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,n)}return e}function y(t,e){var n=(t.length-e)%3;return 0===n?t.toString("base64",e):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-n))}function m(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function w(t){return t.toString(this.encoding)}function v(t){return t&&t.length?this.write(t):""}e.StringDecoder=s,s.prototype.write=function(t){var e,n;if(0===t.length)return"";if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<t.length?e?e+this.text(t,n):this.text(t,n):e||""},s.prototype.end=d,s.prototype.text=h,s.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},993:function(){},88924:function(){},55024:function(){}}]);